var wordCountFt=0;var charCountFtEx=0;var charCountFtIn=0;var charCountFtAll=0;var whitespaceFt=0;var punctuationFt=0;var wordCountCite=0;var charCountCiteEx=0;var charCountCiteIn=0;var charCountCiteAll=0;var whitespaceCite=0;var punctuationCite=0;(function(){tinymce.PluginManager.requireLangPack('wikindxWPStats');tinymce.create('tinymce.plugins.WikindxWPStatsPlugin',{init:function(ed,url){ed.addCommand('mceWikindxWPStats',function(){wikindxWPStats()});ed.addButton('wikindxWPStats',{title:'wikindxWPStats.desc',cmd:'mceWikindxWPStats',image:url+'/img/stats.png'});ed.onNodeChange.add(function(ed,cm,n){cm.setActive('wikindxWPStats',n.nodeName=='IMG')})},getInfo:function(){return{longname:'WikindxWPStats plugin',author:'Mark Grimshaw-Aagaard',authorurl:'https://wikindx.sourceforge.io',infourl:'',version:"1.1"}},});tinymce.PluginManager.add('wikindxWPStats',tinymce.plugins.WikindxWPStatsPlugin)})();function wikindxWPStats(){var justText;var pageCount=false;justText=tinyMCE.get('paperText').getContent({format:'text'});justText=trim(justText);justText=justText.replace(/\r\n|\n|\r/g,'');justText=justText.replace(/\r|\n|<p>&nbsp;<\/p>|<p>\s*<br>\s*<\/p>/ig,'');justText=justText.replace(/<p.*?>(.*?)<\/p>|(<br>\s*){2}/ig,"__WIKINDX__WORDBREAK__$1");justText=justText.replace(/<.*?>|<\/.*?>|<.*?>(.*?)<\/.*?>/g,"$1");justText=justText.replace(/\s{1,1}/g,"&nbsp;");justText=justText.replace(/\s/g,'');justText=justText.replace(/^__WIKINDX__WORDBREAK__|__WIKINDX__WORDBREAK__$|^&nbsp;|&nbsp;$|^&nbsp;__WIKINDX__WORDBREAK__|__WIKINDX__WORDBREAK__&nbsp;$/g,'');justText=trim(justText);if(justText==''){alert("Nothing to count");return}var justTextFt=justText;justText=justText.replace(/\[footnote\].*?\[\/footnote\]/g,'');var justTextCite=justText;justText=justText.replace(/\[cite\].*?\[\/cite\]/g,'');var whitespace=justText.match(/&nbsp;|__WIKINDX__WORDBREAK__/g);if(whitespace==null)whitespace=0;else whitespace=whitespace.length;var wc=justText.split(/&nbsp;{1}|__WIKINDX__WORDBREAK__/g);var wordCount=0;for(var i=0;i<wc.length;i++){if(wc[i]!='')++wordCount}footnotes(justTextFt);citations(justTextCite);if(wordCount>1000)pageCount=Math.round(wordCount/(40*15));justText=justText.replace(/&nbsp;|__WIKINDX__WORDBREAK__/g,'');justText=justText.replace(/&.*?;/g,'`');var punctuation=justText.match(/[\.,\:;\?\!`'"]/g);if(punctuation==null)punctuation=0;else punctuation=punctuation.length;justText=justText.replace(/[\.,\:;\?\!`'"]/g,'');var charCountEx=justText.length;var charCountIn=charCountEx+punctuation;var charCountAll=charCountIn+whitespace;if(charCountEx==0)alert("Nothing to count");else if(pageCount)alert("Character Count (excluding punctuation & space) = "+charCountEx+"\n"+"Character Count (including punctuation excluding space) = "+charCountIn+"\n"+"Character Count (including punctuation & space) = "+charCountAll+"\n"+"Word Count (excluding cite tags and footnotes) = "+wordCount+"\n"+"Word Count (excluding cite tags) = "+wordCountFt+"\n"+"Approximate Page Count = "+pageCount+" @40 lines/page, 15 words/line\n"+"\nPunctuation is: . , : ; ` ' \" ! ? \n");else{var totalWordCount=wordCount+wordCountFt+wordCountCite;var totalCharCountEx=charCountEx+charCountFtEx+charCountCiteEx;var totalCharCountIn=charCountIn+charCountFtIn+charCountCiteIn;var totalCharCountAll=charCountAll+charCountFtAll+charCountCiteAll;alert("Excluding citations and footnotes:\n"+"   Character Count (excluding punctuation & space) = "+charCountEx+"\n"+"   Character Count (including punctuation, excluding space) = "+charCountIn+"\n"+"   Character Count (including punctuation & space) = "+charCountAll+"\n"+"   Word Count = "+wordCount+"\n\n"+"Footnotes:\n"+"   Character Count (excluding punctuation & space) = "+charCountFtEx+"\n"+"   Character Count (including punctuation, excluding space) = "+charCountFtIn+"\n"+"   Character Count (including punctuation & space) = "+charCountFtAll+"\n"+"   Word Count = "+wordCountFt+"\n\n"+"Citations:\n"+"   Character Count (excluding punctuation & space) = "+charCountCiteEx+"\n"+"   Character Count (including punctuation, excluding space) = "+charCountCiteIn+"\n"+"   Character Count (including punctuation & space) = "+charCountCiteAll+"\n"+"   Word Count = "+wordCountCite+"\n\n"+"Totals:\n"+"   Character Count (excluding punctuation & space) = "+totalCharCountEx+"\n"+"   Character Count (including punctuation, excluding space) = "+totalCharCountIn+"\n"+"   Character Count (including punctuation & space) = "+totalCharCountAll+"\n"+"   Word Count = "+totalWordCount+"\n\n"+"Punctuation is: . , : ; ` ' \" ! ? \n")}}function footnotes(justTextFt){var wc;var ftPhrase;wordCountFt=0;charCountFtEx=0;charCountFtIn=0;charCountFtAll=0;whitespaceFt=0;punctuationFt=0;var ft=justTextFt.match(/\[footnote\](.*?)\[\/footnote\]/g);if(ft==null)return;for(var i=0;i<ft.length;i++){if(ft[i]!=''){ftPhrase=ft[i].match(/\[footnote\](.*?)\[\/footnote\]/);footnotesChars(ftPhrase[1]);wc=ftPhrase[1].split(/&nbsp;{1}|__WIKINDX__WORDBREAK__/g);for(var x=0;x<wc.length;x++){if(wc[x]!='')++wordCountFt}}}}function footnotesChars(text){var whitespace=text.match(/&nbsp;|__WIKINDX__WORDBREAK__/g);if(whitespace==null)whitespace=0;else whitespaceFt+=whitespace.length;text=text.replace(/&nbsp;|__WIKINDX__WORDBREAK__/g,'');text=text.replace(/&.*?;/g,'`');var punctuation=text.match(/[\.,\:;\?\!`'"]/g);if(punctuation==null)punctuation=0;else punctuationFt+=punctuation.length;text=text.replace(/[\.,\:;\?\!`'"]/g,'');charCountFtEx+=text.length;charCountFtIn=charCountFtEx+punctuationFt;charCountFtAll=charCountFtIn+whitespaceFt}function citations(justTextCite){var wc;var citePhrase;wordCountCite=0;charCountCiteEx=0;charCountCiteIn=0;charCountCiteAll=0;whitespaceCite=0;punctuationCite=0;var cite=justTextCite.match(/\[cite\](.*?)\[\/cite\]/g);if(cite==null)return;for(var i=0;i<cite.length;i++){if(cite[i]!=''){citePhrase=cite[i].match(/\[cite\](.*?)\[\/cite\]/);citationsChars(citePhrase[1]);wc=citePhrase[1].split(/&nbsp;{1}|__WIKINDX__WORDBREAK__/g);for(var x=0;x<wc.length;x++){if(wc[x]!='')++wordCountCite}}}}function citationsChars(text){var whitespace=text.match(/&nbsp;|__WIKINDX__WORDBREAK__/g);if(whitespace==null)whitespace=0;else whitespaceCite+=whitespace.length;text=text.replace(/&nbsp;|__WIKINDX__WORDBREAK__/g,'');text=text.replace(/&.*?;/g,'`');var punctuation=text.match(/[\.,\:;\?\!`'"]/g);if(punctuation==null)punctuation=0;else punctuationCite+=punctuation.length;text=text.replace(/[\.,\:;\?\!`'"]/g,'');charCountCiteEx+=text.length;charCountCiteIn=charCountCiteEx+punctuationCite;charCountCiteAll=charCountCiteIn+whitespaceCite}function trim(inputString){if(typeof inputString!="string")return inputString;var retValue=inputString;var ch=retValue.substring(0,1);while(ch==" "){retValue=retValue.substring(1,retValue.length);ch=retValue.substring(0,1)}ch=retValue.substring(retValue.length-1,retValue.length);while(ch==" "){retValue=retValue.substring(0,retValue.length-1);ch=retValue.substring(retValue.length-1,retValue.length)}while(retValue.indexOf("  ")!=-1){retValue=retValue.substring(0,retValue.indexOf("  "))+retValue.substring(retValue.indexOf("  ")+1,retValue.length)}return retValue}